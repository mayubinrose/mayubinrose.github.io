---
layout: title
title: 语法指导翻译与属性文法
date: 2018-11-28 11:29:32
tags: 编译原理
categories: 课程
---
# 语法指导翻译概述
编译程序划分成前端和后端，前端包括词法分析，语法分析，语义分析，中间代码生成，符号表的建立，以及和机器无关的中间代码优化。后端通常包括和机器相关的代码优化，目标代码生成，相关的错误处理以及符号表的访问
语义分析器的主要任务是检查各个语法结构的静态语义，即验证语法正确的程序结构是否真正有意义，也称为**静态语义分析**或**静态检查**
 <!--more--> 
类型检查：操作数和操作符的类型是否相容；
控制流检查：控制流转向目标地址是否合法；
惟一性检查：对象是否被重复定义；
关联名检查：同一名字多次特定出现是否一致
***将静态检查和中间代码生成结合到语法分析中进行的技术称为语法制导翻译***
在进行语法分析的同时，完成相应的语义处理
如何根据被识别出来的语法结构进行语义处理？1.语法指导定义2.语法指导翻译模式
# 语法指导定义（SDD)
**综合属性**：该节点或子节点属性值计算出来**继承属性**：该节点，该节点的兄弟节点或父节点的属性值计算出来**固有属性**：通过词法分析直接得到的属性，归类于综合属性(终结符只有综合属性，非终结符都可以有，文法的开始符号的继承属性要提前定义)**副作用**：打印某个值或者修改某个全局变量**属性文法**：没有副作用的SDD，语义规则单纯根据常数和其他属性的值来定义某个属性的值
**S-属性定义**：只含综合属性，通常在自底向上的分析方法计算属性值 
**出现在产生式左边的继承属性和出现在产生式右边的综合属性都不由所给的产生式的属性计算规则进行计算**
# 属性计算
## 依赖图
依赖图其实就是一个有向图，用于描述分析树中节点的属性和属性间的相互依赖关系。
每个属性对应依赖图中的一个节点，如果属性b依赖于属性c，则从属性c的节点有一条有向边指向属性b的节点。属性间的依赖关系是根据相应的语义规则确定的。如果依赖图中没有回路，则利用它可以很方便地求出属性的计算顺序。
## 属性的计算顺序
拓扑顺序：若依赖图中有环，不存在拓扑顺序，属性的计算存在循环依赖关系，若无环，则存在一个拓扑顺序，就是属性值的计算顺序
## S-属性定义
只含综合属性的SDD称为S-属性定义，可以按照自下而上的顺序来计算分析树中节点的属性。一种简单的属性计算方法是对分析树进行后根遍历，在最后一次遍历节点N时计算与节点N相关联的属性
## L-属性定义
当且仅当它的每个属性或者是综合属性，或者是满足如下条件的继承属性：
设有产生式A→X1X2…Xn，右部符号Xi (1≤i≤n)的继承属性只依赖于下列属性：
⑴ A的继承属性；
⑵ 产生式中Xi左边的符号X1、X2、…、Xi-1的综合属性或继承属性；
⑶ Xi本身的综合属性或继承属性，但前提是Xi的属性不能在依赖图中形成回路。
## 属性计算示例
抽象语法树是把分析树中对语义无关紧要的成分去掉，是分析树的抽象形式。
构造表达式的抽象语法树使用的函数
1.mknode(op, left, right) 建立一个标记为op的运算符结点，两个域left和right分别是指向左右运算对象的指针。 
2.mkleaf(id, entry) 建立一个标记为id的标识符结点，其域entry是指向该标识符在符号表中相应表项的指针。 
3.mkleaf(num, val) 建立一个标记为num的数结点，其域val用于保存该数的值。
![sl](/语法指导翻译与属性文法/p1.png "构造表达式的抽象语法树的语法指导定义")
![sl](/语法指导翻译与属性文法/p2.png "在自顶向下分析过程中构造语法树")
# 翻译模式（SDT）
翻译模式是语法制导定义的一种实现形式。其中属性与文法符号相关联，语义规则(也称为语义动作)用花括号｛ ｝括起来，可插入到产生式右部任何合适的位置。
继承属性先计算出来，综合属性最后面计算
如果综合属性和继承属性都有，在建立翻译模式的时候就必须保证：
1.产生式右边的符号的继承属性必须在这个符号以前的动作中计算出来
2.一个动作不能引用这个动作右边的符号的综合属性
3，产生式左边非终结符的综合属性只有在它所引用的属性都计算出来才能计算，通常在产生式右端的尾部
## 翻译模式有语义动作的执行时机
翻译模式设计的前提：保证语义动作不会引用还没计算出来的属性值
1.只有综合属性的情况：直接把赋值动作放在相应的产生式右部的末尾
2.既有综合属性又有继承属性：产生式右边的符号的继承属性必须在这个符号以前的动作中计算出来。一个动作不能引用这个动作右边符号的综合属性。产生式左边非终结符号的综合属性只有在它所引用的所有属性都计算出来以后才能计算。计算这种属性的动作通常可放在产生式右部的末尾。
## S-属性定义的自底向上翻译
后缀式语法指导翻译模式：将语义规则放在产生式末尾形成语法翻译。归约前调用相应的语义子程序，完成翻译的任务
S属性文法的计算：在分析栈中使用一个附加的域存放综合属性值
## L-属性定义的自顶向下翻译
消除左递归：1.只有简单语义动作时的左递归消除，带着语义动作走2.S-属性定义的左递归消除。例如：A→A1Y｛A.a:=g(A1.a,Y.y)}  A→X ｛A.a:=f(X.x)} 消除后： A→X｛R.i:=f(X.x} R｛A.a:=R.s}  R→Y ｛R1.i:=g(R.i,Y.y)} R｛R.s:=R1.s}      R→ε  ｛R.s:=R.i} 
引入继承属性R.i来收集应用函数g的计算结果。其初始值为A.a:=f(X.x）引入综合属性R.s在R结束生成Y时复制R.i的值。
![yuan](/语法指导翻译与属性文法/p3.png "未消除前的计算")
![yuan](/语法指导翻译与属性文法/p4.png "消除后的计算")
## L-属性定义的自底向上翻译
关键：如何自底向上地计算继承属性
修改文法：1.计算继承属性的动作嵌入在非终结符的前面，而将计算综合属性的动作放在产生式的末尾2.在每个嵌入动作处引入一个**标记性非终结符**不同位置对应的标记不同**形如M->ε的产生式**3.如果标记性非终结符M取代了某个产生式A→α{a}β中的动作a，则为M设置继承属性来复制动作a所需要的A或α中符号的继承属性；以与动作a相同的方式计算属性，只不过要将这些属性置为M的综合属性。